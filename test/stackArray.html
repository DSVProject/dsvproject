<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="d3/d3.js"></script>
    <script type="text/javascript" src="js/jquery-2.1.1.js"></script>
    
    <style>
      circle{
        fill:white;
        stroke:black;
        stroke-width:2px;
      }
      
      .array-sqr{
        fill:white;
        stroke:black;
        stroke-width:2px;
      }
      
      .array-highlight{
        stroke:gold;
        stroke-width:7px;
        fill-opacity:0.0;
      }
      
      .label{
        font-family:sans-serif;
        font-size:18px;
        text-anchor:middle;
        fill:black;
      }
      
      #txt-input{
        font-family:sans-serif;
        color:grey;
        font-style:italic;
      }
      
    </style>
  </head>
  <body>
    <div>
      <input type="text" id="txt-input" maxlength="4" placeholder="Enter new values here">
      <input type="button" id="btn-push" onclick="push()" value="Push">
      <input type="button" id="btn-pop" onclick="pop()" value="Pop">
      <input type="button" id="btn-clear" onclick="empty()" value="Clear">
      <input type="button" id="btn-resetPos" onclick="resetPos()" value="Reset Position">
    </div>
    <div id="viz"></div>
    
    <script type="text/javascript">
      var internalArray = {};
      
      //general variables
      internalArray = [
        {"idx":"top","x":50,"y":50, "value":0},
        //{"idx":"tail","x":150,"y":50, "value":0},
        {"idx":0,"x":50,"y":300, "value":null},
        {"idx":1,"x":100,"y":300, "value":null},
        {"idx":2,"x":150,"y":300, "value":null},
        {"idx":3,"x":200,"y":300, "value":null},
        {"idx":4,"x":250,"y":300, "value":null},
        {"idx":5,"x":300,"y":300, "value":null},
        {"idx":6,"x":350,"y":300, "value":null},
        {"idx":7,"x":400,"y":300, "value":null},
        {"idx":8,"x":450,"y":300, "value":null},
        {"idx":9,"x":500,"y":300, "value":null},
        {"idx":10,"x":550,"y":300, "value":null},
        {"idx":11,"x":600,"y":300, "value":null},
        {"idx":12,"x":650,"y":300, "value":null},
        {"idx":13,"x":700,"y":300, "value":null},
        {"idx":14,"x":750,"y":300, "value":null},
        {"idx":15,"x":800,"y":300, "value":null}
      ]

      var width = 900,
      height = 500;
          
      var zoom = d3.behavior.zoom();
      
      // layout code      
      var svgContainer = d3.select("#viz").append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("pointer-events", "all")
        .style("border", "1px solid black"); 
        
      draw();
      
      function draw(){
        // this code enables panning and zooming
        var panGroup = svgContainer.append("g")
          //.call(zoom.on("zoom", rescale))
          .append("g")
          .attr("id", "g-pan");
        
        panGroup.append("rect")
          .attr("width", width)
          .attr("height", height)
          .attr("fill", "white");      
        
        // this groups will hold the graphic elements          
        var arrayGroup = panGroup.append("g")
          .attr("id", "g-array");
          
        var labelGroup = panGroup.append("g")
          .attr("id", "g-label");
          
        var textGroup = panGroup.append("g")
          .attr("id", "g-text");
          
        // this code create the graphic elements
        var positions = arrayGroup.selectAll("rect")
          .data(internalArray)
          .enter()
          .append("rect")              
          .attr("id", function (d) {return "array-" + d.idx; })
          .attr("class", "array-sqr")
          .attr("x", function (d) {return d.x;})
          .attr("y", function (d) {return d.y;})
          .attr("height", 50)
          .attr("width", 50);
          //.on("mouseover", function(){d3.select(this).style("fill", "pink");})
          //.on("mouseout", function(){d3.select(this).style("fill", "white");});
          
        var labels = labelGroup.selectAll("text")
          .data(internalArray)
          .enter()
          .append("text")
          .attr("class", "label")
          .attr("x", function (d) {return d.x + 25;})
          .attr("y", function (d) {return d.y + 80;})
          .text(function (d) { return d.idx; });
          
        var texts = textGroup.selectAll("text")
          .data(internalArray)
          .enter()
          .append("text")
          .attr("id", function (d) {return "text-" + d.idx; })
          .attr("class", "label")
          .attr("x", function (d) {return d.x + 25;})
          .attr("y", function (d) {return d.y + 30;})
          .text(function (d) {return d.value;})
      }
      
      var stack = new FixedCapacityStack();
    
      // general functions
        
      // reposition g
      function rescale() {
        d3.select("#g-pan").attr("transform", "translate(" + d3.event.translate + ") scale(" + d3.event.scale + ")");
      }
      
      function resetPos() {
        d3.select("#g-pan").attr('transform', null);
        zoom.scale(1);
        zoom.translate([0, 0]);
      }
      
      // animation functions
      function createHighlight(){        
        d3.select("#g-array")
          .append("rect")
          .attr("id", "array-highlight")
          .attr("class", "array-highlight")
          .attr("x", 50)
          .attr("y", 50)
          .attr("height", 50)
          .attr("width", 50);
      };
      
      function moveHighlight(){
        d3.select("#array-highlight")
          .transition()            
          .delay(100)            
          .duration(1500)
          .attr("x", internalArray[stack.N]["x"])
          .attr("y", 300);
      }
      
      function deleteHighlight(){
        d3.select("#array-highlight")
          .remove();
      } 
      
      function findTop(){        
        var highlight = d3.select("#g-array")
          .append("rect")
          .attr("id", "array-highlight")
          .attr("class", "array-highlight")
          .attr("x", 50)
          .attr("y", 50)
          .attr("height", 50)
          .attr("width", 50)
          
          highlight.transition()            
            .delay(100)            
            .duration(3000)
            .attr("x", internalArray[stack.N]["x"])
            .attr("y", internalArray[stack.N]["y"])
            .remove();
      };
      
      function verify(){
        var input = $("#txt-input");
        
        if (input.val() != ""){
          createHighlight();
          moveHighlight();
        }
      }
      
      function push(){
        var input = $("#txt-input");
        
        stack.push(input.val());
        input.val("");
      }
      
      function pop(){
        stack.pop();
      }
      
      function empty(){
        d3.select("#g-text")
          .selectAll("text")
          .transition()
          .text(null);
          
        d3.select("#text-top")
          .transition()
          .text("0");
          
        stack.N = 0;
      }
          
      //Stack Object  
      function FixedCapacityStack() {
        this.stack = [];
        this.cap = 16;
        this.N = 0;
        
        this.isEmpty = function() { return this.N == 0; }
        
        this.size = function() { return this.N; }
        
        this.push = function(item) { 
          if(this.N < this.cap && item!="") {
            this.stack[this.N] = item;
            d3.select("#text-"+this.N)
              .transition()
              .text(item);
            this.N++;
            
            deleteHighlight()
            
            d3.select("#text-top")
              .transition()
              .text(this.N);
          }
        }
        
        this.pop = function() {
          if(!this.isEmpty()){
            this.N--;
            d3.select("#text-"+this.N)
              .transition()
              .text(null);
            d3.select("#text-top")
              .transition()
              .text(this.N);
            return this.stack[this.N];
          }
        }
        
        this.displayAll = function() { 
          var array = [];
          
          if(this.isEmpty() == true)
            return null;
          for(i=0;i<this.N;i++)
            array[i] = this.stack[i];
          return array; 
        }
      }
      
    </script>
  </body>
</html>    